<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/head :: head"></div>
</head>
<body>

<div th:replace="fragments/header :: header">...</div>

<div class="container">

    <div class="jumbotron">
        <h1>Election of <span th:text="${election.date}"></span></h1>

        <h3>Results</h3>
        <a class="btn btn-raised" th:href="${'/election/'+election.id+'/vote'}">Vote</a>
    </div>

    <div class="jumbotron">
        <h3>Results</h3> are here
        <div class="result" th:each="result: ${results}">
            <span th:text="${result.key.firstName +' '+ result.key.lastName}"></span>
            <span th:text="${result.value}"></span>
        </div>
    </div>

    <div class="jumbotron">
        <h3>Graphs</h3>
        <div class="results-graph">
            <!--Load the AJAX API-->
            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
            <script type="text/javascript" th:inline="javascript">
                /*<![CDATA[*/
                google.charts.load('current', {'packages': ['bar']});
                google.charts.setOnLoadCallback(drawChart);

                function drawChart() {
                    var jsonData = $.ajax({
                        // url: "/api/election/1/results",
                        url: /*[['/api/election/'+${election.id}+'/results']]*/,
                        dataType: "json",
                        async: false
                    }).responseText;


                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Candidate');
                    data.addColumn('number', 'Votes');

                    jsonData = JSON.parse(jsonData);
                    console.log(jsonData);

                    for (var i = 0; i < jsonData.length; i++) {
                        var deta = jsonData[i];
                        // var detI = new Date(deta.createdAt);
                        // var startDate = new Date(1522713600);
                        // var endDate = new Date();
                        // if (startDate <= deta.createdAt && endDate >= deta.createdAt) {
                        var row = [deta.name, deta.votes];
                        console.log('deta', deta, row);
                        data.addRow(row)
                        // } else console.log('date', detI.getDate())
                    }

                    console.log(data);

                    // new google.visualization.DataTable(jsonData);

                    var options = {
                        chart: {
                            title: 'Vote results',
                        },
                        bars: 'horizontal' // Required for Material Bar Charts.
                    };

                    var chart = new google.charts.Bar(document.getElementById('chart_div'));

                    chart.draw(data, google.charts.Bar.convertOptions(options));
                }
                /*]]>*/
            </script>
            <div id="chart_div"></div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer">...</div>

</body>
</html>